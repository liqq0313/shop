{include file='common/meta'}
<link rel="stylesheet" href="__ADMIN__/lib/jqueryTreescroll/css/tree.css" />
<title>基本设置</title>
</head>
<body>
<!-- <nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页
    <span class="c-gray en">&gt;</span>
    系统管理
    <span class="c-gray en">&gt;</span>
    基本设置
    <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a>
</nav> action="{:url('admin/goods/save')}"-->
<div class="page-container">
    <form class="form form-horizontal" id="form-article-add" enctype="multipart/form-data"  method="post" action="">
        <div id="tab-system" class="HuiTab">
            <div class="tabBar cl">
                <span>基本设置</span>
                <span>商品轮播图片</span>
                <span>详情设置</span>
            </div>
            <div class="tabCon">
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品图片：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        {if isset($goods)}
                        <span class="c-gray col-xs-1 col-sm-1">原图</span><img src="/{$goods['image']}" class="col-xs-6 col-sm-5" style="width:100px;">
                        {/if}
                        <input type="file" placeholder="商品图片" class="col-xs-6 col-sm-5" name="image"/>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品名称：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="name" type="text"  class="col-xs-6 input-text" value="{$goods?$goods['name']:''}" required/>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品分类：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <div class="treebox scrollXY"><div class="tree"><ul></ul></div></div>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品编号：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="model" type="text"  class="col-xs-6 input-text" value="{$goods?$goods['model']:''}" required/>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品关键字：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="meta_keyword" type="text"  class="col-xs-6 input-text" value="{$goods?$goods['meta_keyword']:''}" required/>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品售价：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="price" type="text"  class="col-xs-6 input-text" value="{$goods?$goods['price']:''}" required/><em class="Prompt">将保留两位小数</em>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品积分：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="points" type="text"  class="col-xs-6 input-text" value="{$goods?$goods['points']:''}" required/>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品重量：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="weight" type="text"  class="col-xs-6 input-text" value="{$goods?$goods['weight']:''}" required/>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>库存单位：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="sku" type="text"  class="col-xs-6 input-text" value="{$goods?$goods['sku']:''}" required/>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>生产地：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="location" type="text"  class="col-xs-6 input-text" value="{$goods?$goods['location']:''}" required/>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>优惠活动：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="discount" type="text"  class="col-xs-1 input-text" value="{$goods?$goods['discount']:''}" required/><em class="Prompt">将保留一位小数</em>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>库存量：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="quantity" type="text"  class="col-xs-6 input-text" value="{$goods?$goods['quantity']:''}" required/>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>库存状态：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        {if empty($goods)||$goods['stock_status_id']}<select class="select" name="stock_status_id"><option selected="stock_status_id" value="1">有存货</option><option value="0">备货中</option></select>{else}<select class="select" name="stock_status_id"><option value="1">有存货</option><option selected="" value="0">备货中</option></select>{/if}
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品状态：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        {if empty($goods)||$goods['status']}<input type="radio" name="status" checked="" value="1"><span class="lbl">上架</span><input type="radio" name="status" value="0"><span>下架</span>{else}<input type="radio" name="status" value="1"><span class="lbl">上架</span><input type="radio" name="status" checked="" value="0"><span>下架</span>{/if}
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品颜色：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="color" type="text"  class="col-xs-6 input-text" value="{$goods?$goods['color']:''}" required/><em class="Prompt">不同颜色之间请用空格隔开</em>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品尺码：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="size" type="text"  class="col-xs-6 input-text" value="{$goods?$goods['size']:''}" required/><em class="Prompt">不同尺码之间请用空格隔开</em>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>是否运送：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        {if empty($goods)||$goods['shipping']}<input type="radio" name="shipping" checked="" value="1"><span class="lbl">是</span><input type="radio" name="shipping" value="0"><span>否</span>{else}<input type="radio" name="shipping" value="1"><span class="lbl">是</span><input type="radio" name="shipping" checked="" value="0"><span>否</span>{/if}
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>最少起订数：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="minimum" type="text"  class="col-xs-1 input-text" value="{$goods?$goods['minimum']:''}" required/>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>默认排序：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input name="sort_order" type="text"  class="col-xs-1 input-text" value="{$goods?$goods['sort_order']:''}" required/><input type="hidden" name="goods_id" value="{$goods?$goods['goods_id']:''}">
                    </div>
                </div>
            </div>
            <div class="tabCon">
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2">图片轮播图上传：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <div class="addbtn_wrap">
                        <input type="button" class="btn btn-primary" value="点击添加图片" id="addImgSlider">  
                        <input type="file" name="imageslider[]">  
                        </div> 
                        <div class="img_wrap">  
                        </div> 
                    </div>
                </div>
            </div>
            <div class="tabCon">
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2">详细设置：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <div class="addbtn_wrap">
                        <input type="button" class="btn btn-primary" value="点击添加商品描述" id="addImgDeta">  
                        </div> 
                        <div class="img_deta_wrap">  
                        </div> 
                    </div>
                </div>
            </div>
        </div>
        <div class="row cl">
                    <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
                        <button class="btn btn-primary radius save_base" type="submit"><i class="Hui-iconfont">&#xe632;</i> 保存并提交审核</button>
                        <button onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
                    </div>
                </div>
    </form>
</div>

<!--_footer 作为公共模版分离出去-->
{include file='common/footer'}

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="__ADMIN__/lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="__ADMIN__/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="__ADMIN__/lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="__ADMIN__/lib/jquery.validation/1.14.0/messages_zh.js"></script>
<!-- <script type="text/javascript" src="__ADMIN__/lib/webuploader/0.1.5/webuploader.min.js"></script> -->
<script type="text/javascript">
$(function(){
    $('.skin-minimal input').iCheck({
        checkboxClass: 'icheckbox-blue',
        radioClass: 'iradio-blue',
        increaseArea: '20%'
    });
    $("#tab-system").Huitab({
        index:0
    });


    $.get("{:url('index/category/getCateName')}",
        function(data){
        showCategory(data,$('.tree ul'));
        $.getScript("__ADMIN__/lib/jqueryTreescroll/js/treescroll.min.js");
    });

     $('#addImgSlider').click(function(){
        $('.img_wrap').append('<input type="file" name="imageslider[]"><br/>');
    });

     $("#addImgDeta").click(function(){
        $('.img_deta_wrap').append('<input type="text" name="imagedetaTxt[]" class="col-xs-1 input-text" value="" placeholder="描述">'+
            '<input type="file" name="imagedeta[]" class="col-xs-12"><br/>');
     });

    function showCategory(data,parent)
    {
        var arr = [];
        var oLi;
        for(var child in data)
        {
            if (data[child]['son'].length>0) {
                oLi = $("<li><div class='close_menu'><span></span><a cid='"+data[child]['category_id']+"'>"+data[child]['name']+"</a></div><ul></ul></li>");
                oLi.appendTo(parent);
                showCategory(data[child]['son'] , oLi.find("ul"));
            }else{
                oLi = $("<li><a cid='"+data[child]['category_id']+"'>"+data[child]['name']+"</a></li>");
                oLi.appendTo(parent);
            }
        }
    }

    $('#form-article-add').submit(function(event){  
        //ajax方式提交form表单信息给服务器  
        event.preventDefault(); //阻止浏览器form表单提交  
        var form=document.getElementById("form-article-add");  
        var fd =new FormData(form);
        var id = $('a.ontree').attr('cid');
        if (id == undefined) {alert('必须选择商品分类');return false;}
        var url = '';
        if($("input[name='goods_id']").val()){
            url = "{:url('admin/goods/updateGoods')}";
        }else{
            url = "{:url('admin/goods/addGoods')}";
        }
        fd.append('category',id);
        $.ajax({  
            url:url,
            type:'post',  
            data:fd,  
            processData: false, 
            contentType: false,  
            dataType:'json',          
            success:function(data){
                var msgs = data.msg;
                if(data.status == 1){
                    layer.msg(msgs, {
                      icon: 1,
                      time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    }, function(){
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.$('.btn-refresh').click();
                        window.parent.location.reload();
                        parent.layer.close(index);
                    }); 
                }else{
                    layer.msg(msgs,{icon:2,time:2000});
                }
            }  
        });  
    });  
});
</script>
</body>
</html>
